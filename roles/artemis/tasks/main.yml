---
# Check for compatible Ansible version.
- name: Check for compatible Ansible version.
  assert:
    that: ansible_version.full is version_compare('2.16', '>=')
    msg: You need Ansible version 2.16 or higher.

# Check if variables are set correctly
- include_tasks: variable_checks.yml

- include_tasks: node_checks.yml
  when: 
    - continuous_integration.localci is defined
    - is_build_agent is defined and (is_build_agent | bool)

# Create Artemis and (if desired) deployment users.
- include_tasks: users.yml
  when: 
    - setup_system | bool

# Install JDK
- include_tasks: jdk.yml
  when:
    - not (use_docker | bool)
    - setup_system | bool

# Configure the Artemis systemd service
- include_tasks: artemis_setup.yml
  when:
    - not (use_docker | bool)
    - setup_system | bool

# Configure Artemis application
- include_tasks: artemis_config.yml
  when:
    - not (use_docker | bool)
    - update_artemis_config | bool

# Install Artemis to the host
- include_tasks: deploy_artemis.yml
  when: 
    - download_artemis_application
    - not (use_docker | bool)

# Install Artemis to the host using Docker
- include_tasks: docker_deploy_artemis.yml
  when:
    - (use_docker | bool)

# Restart Artemis
- include_tasks: restart_artemis.yml
  when: 
    - not (use_docker | bool)
    - restart_artemis | bool
